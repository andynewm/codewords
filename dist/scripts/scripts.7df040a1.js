angular.module("codeword",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/select.html",controller:"selectCtrl"}).when("/:id",{templateUrl:"views/puzzle.html",controller:"puzzleCtrl",resolve:{puzzle:["puzzleFactory","$route",function(a,b){return a.load(b.current.params.id)}]}}).otherwise({redirectTo:"/"})}]),angular.module("codeword").controller("puzzleCtrl",["$scope","puzzle",function(a,b){a.map=b.map,a.state=b.state,a.initState=b.initState,a.selected=null,a.select=function(b){a.selected=b},a.setLetter=function(c,d){a.$apply(function(){b.setLetter(c,d)})},a.match=function(a){return b.match(a)},a.isSolved=function(){return b.isSolved()}}]),angular.module("codeword").controller("selectCtrl",["$scope",function(a){a.range=function(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}}]),angular.module("codeword").factory("puzzleFactory",["$http","$q",function(a,b){function c(c){var e=b.defer();return a.get("puzzles/puzzle"+c+".json").success(function(a){e.resolve(new d(a))}).error(function(){e.reject()}),e.promise}function d(a){this.state=a.state,this.initState=a.state.slice(0),this.solution=a.solution,this.map=a.map,this.inverseState=a.state.reduce(function(a,b,c){return b&&(a[b]=c+1),a},{}),this.inverseInitialState=$.extend({},this.inverseState)}return d.prototype.setLetter=function(a,b){if(!this.inverseInitialState[b]){var c=this.state,d=this.inverseState;c[a]&&delete d[c[a]],c.forEach(function(a,d){a==b&&(c[d]=null)}),c[a]=b,d[b]=a+1}},d.prototype.isSolved=function(){var a=this.state,b=this.solution;return a.every(function(a,c){return a==b[c]})},d.prototype.match=function(a){return this.inverseState[a]},{load:c}}]),angular.module("codeword").directive("testd",function(){function a(a){return 64==(a-1&64)&&26>(a-1&31)}return{link:function(b,c){c.on("click",function(){$(this).focus()}),c.on("keydown",function(c){var d;switch(c.which){case 39:return $(this).closest("td").nextAll().find(".cell:not(.default)").first().click(),!1;case 38:return d=$(this).closest("td").index()+1,$(this).closest("tr").prevAll().find("td:nth-child("+d+") .cell:not(.default)").last().click(),!1;case 37:return $(this).closest("td").prevAll().find(".cell:not(.default)").last().click(),!1;case 40:return d=$(this).closest("td").index()+1,$(this).closest("tr").nextAll().find("td:nth-child("+d+") .cell:not(.default)").first().click(),!1;case 8:return b.setLetter(b.cell,null),!1}if(a(c.which)){var e=String.fromCharCode(c.which).toUpperCase();b.setLetter(b.cell,e)}})}}}),angular.module("codeword").filter("pad",function(){return function(a,b){return(new Array(b).join("0")+a).substr(-b)}});